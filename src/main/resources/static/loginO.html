<!DOCTYPE html>
<html lang="ko">
<head>
    <script>
        // 가장 먼저 로드되는 스크립트에서
        window.BASE = window.BASE || 'http://localhost:8080';

        window.TOKEN = localStorage.getItem('auth_token') || null;

        window.authHeaders = function () {
          return window.TOKEN
            ? { Authorization: window.TOKEN, 'Content-Type': 'application/json' }
            : { 'Content-Type': 'application/json' };
        };

        window.setToken = function (raw) {
          const bearer = raw?.startsWith('Bearer ') ? raw : `Bearer ${raw}`;
          window.TOKEN = bearer;
          localStorage.setItem('auth_token', bearer);
        };

        window.escapeHtml = function (s = '') {
          return String(s)
            .replaceAll('&', '&amp;')
            .replaceAll('<', '&lt;')
            .replaceAll('>', '&gt;')
            .replaceAll('"', '&quot;')
            .replaceAll("'", '&#39;');
        };

        window.formatPrice = function (v) {
          if (v == null) return '-';
          try { return Number(v).toLocaleString('ko-KR') + '원'; }
          catch { return String(v); }
        };

        window.timeKST = function (iso) {
          return iso ? iso.replace('T', ' ').slice(0, 16) : '';
        };
    </script>
    <script>
        // 쿼리스트링 빌더
        function buildQuery(params) {
          if (!params) return '';
          const q = new URLSearchParams();
          for (const [k, v] of Object.entries(params)) if (v !== undefined && v !== null) q.append(k, v);
          const s = q.toString();
          return s ? `?${s}` : '';
        }

        // 전역 API 래퍼
        window.api = async function (path, { method='GET', params, json, headers, ...rest } = {}) {
          const url = `${window.BASE}${path}${buildQuery(params)}`;
          const baseHeaders = window.TOKEN ? { Authorization: window.TOKEN } : {};
          if (json !== undefined) baseHeaders['Content-Type'] = 'application/json';


          const ct = res.headers.get('content-type') || '';
          const data = ct.includes('application/json') ? await res.json() : await res.text();
          if (!res.ok) {
            const msg = typeof data === 'string' ? data : (data?.message || res.statusText);
            throw new Error(`HTTP ${res.status} ${msg}`);
          }
          return data;
        };

        // 편의 메서드
        window.api.get  = (p, opt={}) => window.api(p, { ...opt, method: 'GET' });
        window.api.post = (p, opt={}) => window.api(p, { ...opt, method: 'POST' });
        window.api.del  = (p, opt={}) => window.api(p, { ...opt, method: 'DELETE' });
    </script>

    <script>
        // 초기값 false로 두고 시작
        var isProfilePanelOpen = false;
        var isChatPanelOpen = false; // 이거도 같은 에러 났었죠
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>부동산 매물 찾기</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin />
    <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap"
            rel="stylesheet"
    />

    <link rel="stylesheet" href="./css/map.css" />
    <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=madicr2e0g"></script>
    <script>
        // loginO.html 상단(해당 스크립트보다 먼저) 또는 공용 JS에
        window.isChatPanelOpen = window.isChatPanelOpen ?? false;
    </script>
    <style>
        /* Custom Styles */
        body {
            font-family: "Inter", "Noto Sans KR", sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        #right-side-panel {
            z-index: 30;
        }
        #notification-panel {
            z-index: 20;
        }
        #favorite-panel {
            z-index: 20;
        }
        #compare-panel {
            z-index: 20;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen overflow-hidden">
<div class="relative w-full h-full">
    <!-- =================================================================== -->
    <!-- 지도 및 필터 패널                                                     -->
    <!-- =================================================================== -->
    <main class="w-full h-full">
        <main id="container">
            <!-- 지도 영역 (실제 지도 API로 대체될 부분)
              <div class="absolute inset-0 bg-gray-300 flex items-center justify-center">
                  <p class="text-gray-500 text-2xl">[ 지도 영역 ]</p>
              </div>-->
            <div id="map"></div>
        </main>

        <!-- 상단 검색 및 필터 바 -->
        <div
                id="search-bar-container"
                class="absolute top-6 flex flex-row flex-wrap items-center gap-3 z-10 transition-all duration-300 ease-in-out"
                style="left: 474px; right: 99px"
        >
            <!-- Search Bar -->
            <div
                    class="flex items-center bg-white rounded-full shadow-lg px-4 py-2 flex-shrink-0"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="text-gray-400 mr-3 flex-shrink-0"
                >
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input
                        type="text"
                        placeholder="동, 지하철역, 대학교, 매물번호"
                        class="w-56 focus:outline-none bg-transparent text-sm"
                />
            </div>

            <!-- Filter Buttons -->
            <div
                    id="house-type-wrapper"
                    class="relative inline-block bg-white rounded-full shadow-lg"
            >
                <button
                        id="house-type-button"
                        class="px-4 py-3 text-gray-700 text-sm font-medium bg-white hover:bg-gray-100 rounded-full leading-tight focus:outline-none"
                >
                    <span class="block">주거형태</span>
                    <span
                            id="house-type-selected-label"
                            class="block text-[11px] text-blue-600 font-semibold mt-0.5 hidden"
                    ></span>
                </button>
                <!-- 주거형태 드롭다운: 버튼 바로 아래 정렬 -->
                <div
                        id="house-type-dropdown"
                        class="absolute left-0 top-full mt-2 bg-white rounded-xl shadow-lg p-2 flex flex-row flex-nowrap items-center gap-2 z-20 hidden"
                >
                    <button
                            data-type="아파트"
                            class="house-type-option whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        아파트
                    </button>
                    <button
                            data-type="빌라"
                            class="house-type-option whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        빌라
                    </button>
                    <button
                            data-type="원/투룸"
                            class="house-type-option whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        원/투룸
                    </button>
                </div>
            </div>

            <div
                    id="offer-type-wrapper"
                    class="relative inline-block bg-white rounded-full shadow-lg"
            >
                <button
                        id="offer-type-button"
                        class="px-4 py-3 text-gray-700 text-sm font-medium bg-white hover:bg-gray-100 rounded-full leading-tight focus:outline-none"
                >
                    <span class="block">거래방식</span>
                    <span
                            id="offer-type-selected-label"
                            class="block text-[11px] text-blue-600 font-semibold mt-0.5 hidden"
                    ></span>
                </button>
                <div
                        id="offer-type-dropdown"
                        class="absolute left-0 top-full mt-2 bg-white rounded-xl shadow-lg p-2 flex flex-row flex-nowrap items-center gap-2 z-20 hidden"
                >
                    <button
                            data-type="매매"
                            class="offer-type-option whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        매매
                    </button>
                    <button
                            data-type="전세"
                            class="offer-type-option whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        전세
                    </button>
                    <button
                            data-type="월세"
                            class="offer-type-option whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        월세
                    </button>
                </div>
            </div>
            <div
                    id="area-wrapper"
                    class="relative inline-block bg-white rounded-full shadow-lg"
            >
                <button
                        id="area-button"
                        class="px-4 py-3 text-gray-700 text-sm font-medium bg-white hover:bg-gray-100 rounded-full leading-tight focus:outline-none"
                >
                    <span class="block">전용면적</span>
                    <span
                            id="area-selected-label"
                            class="block text-[11px] text-blue-600 font-semibold mt-0.5 hidden"
                    ></span>
                </button>
                <div
                        id="area-dropdown"
                        class="absolute left-0 top-full mt-2 bg-white rounded-xl shadow-lg p-4 flex flex-col gap-3 z-20 w-[340px] hidden"
                >
                    <div class="flex items-center justify-between gap-3">
                        <div class="flex-1">
                            <label class="text-xs text-gray-500">최소</label>
                            <div class="relative mt-1">
                                <input
                                        id="area-min-input"
                                        type="text"
                                        inputmode="numeric"
                                        pattern="[0-9]*"
                                        class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="m²"
                                />
                                <span
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"
                                >m²</span
                                >
                            </div>
                        </div>
                        <span class="text-gray-400">~</span>
                        <div class="flex-1">
                            <label class="text-xs text-gray-500">최대</label>
                            <div class="relative mt-1">
                                <input
                                        id="area-max-input"
                                        type="text"
                                        inputmode="numeric"
                                        pattern="[0-9]*"
                                        class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="m²"
                                />
                                <span
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"
                                >m²</span
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div
                    id="floor-wrapper"
                    class="relative inline-block bg-white rounded-full shadow-lg"
            >
                <button
                        id="floor-button"
                        class="px-4 py-3 text-gray-700 text-sm font-medium bg-white hover:bg-gray-100 rounded-full leading-tight focus:outline-none"
                >
                    <span class="block">층수</span>
                    <span
                            id="floor-selected-label"
                            class="block text-[11px] text-blue-600 font-semibold mt-0.5 hidden"
                    ></span>
                </button>
                <div
                        id="floor-dropdown"
                        class="absolute left-0 top-full mt-2 bg-white rounded-xl shadow-lg p-4 flex flex-col gap-3 z-20 w-[340px] hidden"
                >
                    <div class="flex items-center justify-between gap-3">
                        <div class="flex-1">
                            <label class="text-xs text-gray-500">최소</label>
                            <div class="relative mt-1">
                                <input
                                        id="floor-min-input"
                                        type="text"
                                        inputmode="numeric"
                                        pattern="[0-9]*"
                                        class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="층"
                                />
                                <span
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"
                                >층</span
                                >
                            </div>
                        </div>
                        <span class="text-gray-400">~</span>
                        <div class="flex-1">
                            <label class="text-xs text-gray-500">최대</label>
                            <div class="relative mt-1">
                                <input
                                        id="floor-max-input"
                                        type="text"
                                        inputmode="numeric"
                                        pattern="[0-9]*"
                                        class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="층"
                                />
                                <span
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"
                                >층</span
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div
                    id="option-wrapper"
                    class="relative inline-block bg-white rounded-full shadow-lg"
            >
                <button
                        id="option-button"
                        class="px-4 py-3 text-gray-700 text-sm font-medium bg-white hover:bg-gray-100 rounded-full leading-tight focus:outline-none"
                >
                    <span class="block">옵션</span>
                    <span
                            id="option-selected-label"
                            class="block text-[11px] text-blue-600 font-semibold mt-0.5 hidden"
                    ></span>
                </button>
                <div
                        id="option-dropdown"
                        class="absolute left-0 top-full mt-2 bg-white rounded-xl shadow-lg p-2 flex flex-row flex-wrap items-center gap-2 z-20 w-[480px] hidden"
                >
                    <button
                            data-type="풀옵션"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        풀옵션
                    </button>
                    <button
                            data-type="에어컨"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        에어컨
                    </button>
                    <button
                            data-type="냉장고"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        냉장고
                    </button>
                    <button
                            data-type="세탁기"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        세탁기
                    </button>
                    <button
                            data-type="가스레인지"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        가스레인지
                    </button>
                    <button
                            data-type="인덕션레인지"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        인덕션레인지
                    </button>
                    <button
                            data-type="침대"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        침대
                    </button>
                    <button
                            data-type="전자레인지"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        전자레인지
                    </button>
                    <button
                            data-type="TV"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        TV
                    </button>
                    <button
                            data-type="책상"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        책상
                    </button>
                    <button
                            data-type="CCTV"
                            class="option-item whitespace-nowrap min-w-[64px] px-4 py-1.5 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                    >
                        CCTV
                    </button>
                </div>
            </div>
            <div
                    id="all-filter-wrapper"
                    class="relative inline-block bg-white rounded-full shadow-lg"
            >
                <button
                        id="all-filter-button"
                        class="px-5 py-3 text-gray-700 font-semibold text-sm flex items-center gap-2 bg-white hover:bg-gray-100 rounded-full leading-tight focus:outline-none"
                >
                    <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            stroke-width="2"
                    >
                        <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                        />
                    </svg>
                    <span class="block">전체필터</span>
                    <span
                            id="all-filter-selected-label"
                            class="block text-[11px] text-blue-600 font-semibold mt-0.5 hidden"
                    ></span>
                </button>
                <div
                        id="all-filter-dropdown"
                        class="absolute left-0 top-full mt-2 bg-white rounded-xl shadow-lg p-6 z-20 w-[450px] max-h-[80vh] overflow-y-auto hidden"
                >
                    <div class="space-y-6">
                        <!-- 주거형태 -->
                        <div>
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">
                                주거형태
                            </h3>
                            <div class="flex flex-wrap gap-2">
                                <button
                                        data-type="아파트"
                                        class="filter-house-type whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    아파트
                                </button>
                                <button
                                        data-type="빌라"
                                        class="filter-house-type whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    빌라
                                </button>
                                <button
                                        data-type="원/투룸"
                                        class="filter-house-type whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    원/투룸
                                </button>
                            </div>
                        </div>

                        <!-- 거래방식 -->
                        <div>
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">
                                거래방식
                            </h3>
                            <div class="flex flex-wrap gap-2">
                                <button
                                        data-type="매매"
                                        class="filter-offer-type whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    매매
                                </button>
                                <button
                                        data-type="전세"
                                        class="filter-offer-type whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    전세
                                </button>
                                <button
                                        data-type="월세"
                                        class="filter-offer-type whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    월세
                                </button>
                            </div>
                        </div>

                        <!-- 전용면적 -->
                        <div>
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">
                                전용면적
                            </h3>
                            <div class="flex items-center gap-3">
                                <div class="flex-1">
                                    <input
                                            id="filter-area-min"
                                            type="text"
                                            inputmode="numeric"
                                            pattern="[0-9]*"
                                            class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="최소 m²"
                                    />
                                </div>
                                <span class="text-gray-400">~</span>
                                <div class="flex-1">
                                    <input
                                            id="filter-area-max"
                                            type="text"
                                            inputmode="numeric"
                                            pattern="[0-9]*"
                                            class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="최대 m²"
                                    />
                                </div>
                            </div>
                        </div>

                        <!-- 층수 -->
                        <div>
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">층수</h3>
                            <div class="flex items-center gap-3">
                                <div class="flex-1">
                                    <input
                                            id="filter-floor-min"
                                            type="text"
                                            inputmode="numeric"
                                            pattern="[0-9]*"
                                            class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="최소 층"
                                    />
                                </div>
                                <span class="text-gray-400">~</span>
                                <div class="flex-1">
                                    <input
                                            id="filter-floor-max"
                                            type="text"
                                            inputmode="numeric"
                                            pattern="[0-9]*"
                                            class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="최대 층"
                                    />
                                </div>
                            </div>
                        </div>

                        <!-- 준공년도 -->
                        <div>
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">
                                준공년도
                            </h3>
                            <div class="flex items-center gap-3">
                                <input
                                        id="filter-build-year"
                                        type="text"
                                        inputmode="numeric"
                                        pattern="[0-9]*"
                                        class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="예: 2020"
                                />
                            </div>
                        </div>

                        <!-- 가격 (거래방식에 따라 동적 변경) -->
                        <div id="price-section">
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">가격</h3>

                            <!-- 매매가 -->
                            <div id="price-buy" class="hidden">
                                <label class="text-xs text-gray-500 mb-2 block"
                                >매매가</label
                                >
                                <div class="flex items-center gap-3">
                                    <div class="flex-1">
                                        <input
                                                id="filter-buy-min"
                                                type="text"
                                                inputmode="numeric"
                                                pattern="[0-9]*"
                                                class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                placeholder="최소 (만원)"
                                        />
                                    </div>
                                    <span class="text-gray-400">~</span>
                                    <div class="flex-1">
                                        <input
                                                id="filter-buy-max"
                                                type="text"
                                                inputmode="numeric"
                                                pattern="[0-9]*"
                                                class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                placeholder="최대 (만원)"
                                        />
                                    </div>
                                </div>
                            </div>

                            <!-- 전세가 -->
                            <div id="price-jeonse" class="hidden">
                                <label class="text-xs text-gray-500 mb-2 block"
                                >전세가</label
                                >
                                <div class="flex items-center gap-3">
                                    <div class="flex-1">
                                        <input
                                                id="filter-jeonse-min"
                                                type="text"
                                                inputmode="numeric"
                                                pattern="[0-9]*"
                                                class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                placeholder="최소 (만원)"
                                        />
                                    </div>
                                    <span class="text-gray-400">~</span>
                                    <div class="flex-1">
                                        <input
                                                id="filter-jeonse-max"
                                                type="text"
                                                inputmode="numeric"
                                                pattern="[0-9]*"
                                                class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                placeholder="최대 (만원)"
                                        />
                                    </div>
                                </div>
                            </div>

                            <!-- 월세 -->
                            <div id="price-monthly" class="hidden">
                                <div class="space-y-3">
                                    <div>
                                        <label class="text-xs text-gray-500 mb-2 block"
                                        >보증금</label
                                        >
                                        <div class="flex items-center gap-3">
                                            <div class="flex-1">
                                                <input
                                                        id="filter-deposit-min"
                                                        type="text"
                                                        inputmode="numeric"
                                                        pattern="[0-9]*"
                                                        class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                        placeholder="최소 (만원)"
                                                />
                                            </div>
                                            <span class="text-gray-400">~</span>
                                            <div class="flex-1">
                                                <input
                                                        id="filter-deposit-max"
                                                        type="text"
                                                        inputmode="numeric"
                                                        pattern="[0-9]*"
                                                        class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                        placeholder="최대 (만원)"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-xs text-gray-500 mb-2 block"
                                        >월세</label
                                        >
                                        <div class="flex items-center gap-3">
                                            <div class="flex-1">
                                                <input
                                                        id="filter-monthly-min"
                                                        type="text"
                                                        inputmode="numeric"
                                                        pattern="[0-9]*"
                                                        class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                        placeholder="최소 (만원)"
                                                />
                                            </div>
                                            <span class="text-gray-400">~</span>
                                            <div class="flex-1">
                                                <input
                                                        id="filter-monthly-max"
                                                        type="text"
                                                        inputmode="numeric"
                                                        pattern="[0-9]*"
                                                        class="w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                        placeholder="최대 (만원)"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 옵션 -->
                        <div>
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">옵션</h3>
                            <div class="flex flex-wrap gap-2">
                                <button
                                        data-type="풀옵션"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    풀옵션
                                </button>
                                <button
                                        data-type="에어컨"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    에어컨
                                </button>
                                <button
                                        data-type="냉장고"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    냉장고
                                </button>
                                <button
                                        data-type="세탁기"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    세탁기
                                </button>
                                <button
                                        data-type="가스레인지"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    가스레인지
                                </button>
                                <button
                                        data-type="인덕션레인지"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    인덕션레인지
                                </button>
                                <button
                                        data-type="침대"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    침대
                                </button>
                                <button
                                        data-type="전자레인지"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    전자레인지
                                </button>
                                <button
                                        data-type="TV"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    TV
                                </button>
                                <button
                                        data-type="책상"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    책상
                                </button>
                                <button
                                        data-type="CCTV"
                                        class="filter-option whitespace-nowrap px-4 py-2 rounded-full text-sm text-gray-700 bg-gray-100 hover:bg-gray-200"
                                >
                                    CCTV
                                </button>
                            </div>
                        </div>

                        <!-- 적용/초기화 버튼 -->
                        <div class="flex justify-between items-center pt-4 border-t">
                            <button
                                    id="reset-filter"
                                    class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            >
                                초기화
                            </button>
                            <button
                                    id="apply-filter"
                                    class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                            >
                                적용
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- =================================================================== -->
    <!-- 왼쪽 매물 정보 패널 (슬라이드 기능 추가)                              -->
    <!-- =================================================================== -->
    <aside
            id="side-panel"
            class="absolute top-0 left-0 w-[450px] bg-white p-6 flex flex-col h-full shadow-lg z-20 transform transition-all duration-300 ease-in-out"
    >
        <!-- 전체화면에서 돌아오는 버튼 -->
        <button
                id="collapse-fullscreen-button"
                class="absolute top-6 right-6 p-2 rounded-full hover:bg-gray-200 transition-colors hidden z-50"
                title="패널 축소"
        >
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 text-gray-700"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
            >
                <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
                ></path>
            </svg>
        </button>
        <!-- 상단 메뉴 및 정렬 -->
        <div
                class="flex justify-between items-center mb-4 pb-4 border-b flex-shrink-0"
        >
            <button
                    class="bg-gray-800 text-white font-bold py-2 px-6 rounded-md text-lg"
            >
                내집
            </button>
            <div
                    id="add-listing-container"
                    class="flex items-center gap-2 transition-all duration-300 ease-in-out"
            >
                <button
                        class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-md text-sm hover:bg-indigo-700 transition-colors flex items-center gap-2"
                >
                    <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                    >
                        <path
                                fill-rule="evenodd"
                                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                                clip-rule="evenodd"
                        />
                    </svg>
                    새 매물 등록
                </button>
            </div>
        </div>

        <!-- 매물 개수 및 페이지네이션 -->
        <div class="flex justify-between items-center mb-6 flex-shrink-0">
            <p class="font-bold text-gray-800">10,822개의 매물</p>
            <div class="flex items-center space-x-1">
                <button class="px-3 py-1 border rounded-md bg-gray-200">1</button>
                <button class="px-3 py-1 border rounded-md hover:bg-gray-100">
                    2
                </button>
                <button class="px-3 py-1 border rounded-md hover:bg-gray-100">
                    3
                </button>
                <button class="px-3 py-1 border rounded-md hover:bg-gray-100">
                    4
                </button>
            </div>
        </div>

        <!-- 스크롤 가능한 콘텐츠 영역 -->
        <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 -mr-2">
            <!-- 추천 매물 -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-xl font-bold text-gray-800">추천매물</h2>
                    <select class="border rounded-md p-2 text-sm">
                        <option>기본순</option>
                        <option>가격순</option>
                        <option>최신순</option>
                    </select>
                </div>
                <div id="recommended-list" class="grid grid-cols-2 gap-4">
                    <!-- JavaScript로 추천 매물 아이템이 여기에 추가됩니다. -->
                </div>
            </div>

            <!-- 구분선 -->
            <div class="border-t my-6"></div>

            <!-- 일반 매물 -->
            <div>
                <h2 class="text-xl font-bold text-gray-800 mb-3">일반 매물</h2>
                <div id="property-list" class="flex flex-col space-y-4">
                    <!-- JavaScript로 일반 매물 아이템이 여기에 추가됩니다. -->
                </div>
            </div>
        </div>
    </aside>

    <!-- 패널 열기 버튼 -->
    <button
            id="open-panel-button"
            class="absolute top-1/2 -translate-y-1/2 w-8 h-16 bg-white/90 shadow-lg rounded-r-lg flex items-center justify-center z-30 transition-all duration-300 ease-in-out opacity-0 pointer-events-none"
            style="left: 0px"
            title="패널 열기"
    >
        <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-gray-600"
        >
            <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
    </button>

    <!-- 패널 닫기 버튼 -->
    <button
            id="close-panel-button"
            class="absolute top-1/2 w-8 h-16 bg-white/90 shadow-lg rounded-r-lg flex items-center justify-center z-30 transition-all duration-300 ease-in-out"
            style="left: 450px; transform: translateY(calc(-50% + 2.5rem))"
            title="패널 닫기"
    >
        <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-gray-600"
        >
            <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
    </button>

    <!-- 패널 확장 버튼 -->
    <button
            id="expand-panel-button"
            class="absolute top-1/2 w-8 h-16 bg-white/90 shadow-lg rounded-r-lg flex items-center justify-center z-30 transition-all duration-300 ease-in-out"
            style="left: 450px; transform: translateY(calc(-50% - 2.5rem))"
            title="패널 확장"
    >
        <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6 text-gray-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
        >
            <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M13 5l7 7-7 7M5 5l7 7-7 7"
            ></path>
        </svg>
    </button>

    <!-- =================================================================== -->
    <!-- 채팅 패널                                                          -->
    <!-- =================================================================== -->
    <aside
            id="chat-panel"
            class="absolute top-0 w-[450px] bg-white p-6 flex flex-col h-full shadow-lg z-20 transform translate-x-full transition-transform duration-300 ease-in-out"
            style="right: 75px"
    >
        <!-- 채팅 패널 헤더 -->
        <div
                class="flex justify-between items-center mb-4 pb-4 border-b flex-shrink-0"
        >
            <h2 class="text-xl font-bold text-gray-800">채팅 목록</h2>
            <button
                    id="close-chat-panel"
                    class="p-2 rounded-full hover:bg-gray-200 transition-colors"
                    title="채팅 패널 닫기"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18L18 6M6 6l12 12"
                    />
                </svg>
            </button>
        </div>

        <!-- 채팅 검색 -->
        <div class="mb-4 flex-shrink-0">
            <div class="relative">
                <input
                        type="text"
                        placeholder="채팅방 검색"
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    />
                </svg>
            </div>
        </div>

        <!-- 스크롤 가능한 채팅 목록 영역 -->
        <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 -mr-2">
            <div id="chat-list" class="space-y-3">
                <!-- JavaScript로 채팅 목록이 여기에 추가됩니다. -->
            </div>
        </div>
    </aside>

    <!-- =================================================================== -->
    <!-- 프로필 패널                                                        -->
    <!-- =================================================================== -->
    <aside
            id="profile-panel"
            class="absolute top-0 w-[450px] bg-white p-6 flex flex-col h-full shadow-lg z-20 transform translate-x-full transition-transform duration-300 ease-in-out"
            style="right: 75px"
    >
        <!-- 프로필 패널 헤더 -->
        <div
                class="flex justify-between items-center mb-4 pb-4 border-b flex-shrink-0"
        >
            <h2 class="text-xl font-bold text-gray-800">프로필 수정</h2>
            <button
                    id="close-profile-panel"
                    class="p-2 rounded-full hover:bg-gray-200 transition-colors"
                    title="프로필 패널 닫기"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18L18 6M6 6l12 12"
                    />
                </svg>
            </button>
        </div>

        <!-- 스크롤 가능한 프로필 수정 영역 -->
        <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 -mr-2">
            <form id="profile-form" class="space-y-6">
                <!-- 프로필 사진 -->
                <div class="flex flex-col items-center space-y-4">
                    <div class="relative">
                        <div
                                class="w-24 h-24 rounded-full bg-gray-300 flex items-center justify-center overflow-hidden"
                        >
                            <img
                                    id="profile-image"
                                    src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"
                                    alt="프로필 사진"
                                    class="w-full h-full object-cover"
                            />
                        </div>
                        <button
                                type="button"
                                class="absolute bottom-0 right-0 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors"
                        >
                            <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-4 w-4 text-white"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                    stroke-width="2"
                            >
                                <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
                                />
                            </svg>
                        </button>
                    </div>
                    <input
                            type="file"
                            id="profile-image-input"
                            accept="image/*"
                            class="hidden"
                    />
                </div>

                <!-- 기본 정보 -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2"
                        >이름/닉네임</label
                        >
                        <input
                                type="text"
                                id="username"
                                name="username"
                                value="홍길동"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2"
                        >이메일</label
                        >
                        <input
                                type="email"
                                id="email"
                                name="email"
                                value="user@example.com"
                                readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 cursor-not-allowed"
                        />
                        <p class="text-xs text-gray-500 mt-1">
                            이메일은 변경할 수 없습니다.
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2"
                        >전화번호</label
                        >
                        <input
                                type="tel"
                                id="phone"
                                name="phone"
                                value="010-1234-5678"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2"
                        >소개글</label
                        >
                        <textarea
                                id="intro"
                                name="intro"
                                rows="4"
                                placeholder="자신을 소개하는 글을 작성해주세요..."
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                        >
부동산에 관심이 많은 일반 사용자입니다.</textarea
                        >
                        <p class="text-xs text-gray-500 mt-1">
                            최대 200자까지 입력할 수 있습니다.
                        </p>
                    </div>
                </div>

                <!-- 계정 통계 -->
                <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                    <h3 class="text-sm font-semibold text-gray-700">활동 통계</h3>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <p class="text-2xl font-bold text-blue-600">12</p>
                            <p class="text-xs text-gray-500">찜한 매물</p>
                        </div>
                        <div>
                            <p class="text-2xl font-bold text-green-600">3</p>
                            <p class="text-xs text-gray-500">작성한 리뷰</p>
                        </div>
                    </div>
                </div>

                <!-- 저장/취소 버튼 -->
                <div class="flex space-x-3 pt-4">
                    <button
                            type="button"
                            id="cancel-profile-edit"
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"
                    >
                        취소
                    </button>
                    <button
                            type="submit"
                            class="flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                    >
                        저장
                    </button>
                </div>
            </form>
        </div>
    </aside>

    <!-- =================================================================== -->
    <!-- 알림 패널                                                          -->
    <!-- =================================================================== -->
    <aside
            id="notification-panel"
            class="absolute top-0 w-[450px] bg-white p-6 flex flex-col h-full shadow-lg z-20 transform translate-x-full transition-transform duration-300 ease-in-out"
            style="right: 75px"
    >
        <!-- 알림 패널 헤더 -->
        <div
                class="flex justify-between items-center mb-4 pb-4 border-b flex-shrink-0"
        >
            <h2 class="text-xl font-bold text-gray-800">알림</h2>
            <button
                    id="close-notification-panel"
                    class="p-2 rounded-full hover:bg-gray-200 transition-colors"
                    title="알림 패널 닫기"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18L18 6M6 6l12 12"
                    />
                </svg>
            </button>
        </div>

        <!-- 알림 설정 -->
        <div class="mb-4 flex-shrink-0">
            <div
                    class="flex items-center justify-between bg-gray-50 p-3 rounded-lg"
            >
                <span class="text-sm text-gray-700">모든 알림 읽음 처리</span>
                <button
                        class="text-sm text-blue-600 hover:text-blue-800 font-medium"
                >
                    모두 읽음
                </button>
            </div>
        </div>

        <!-- 스크롤 가능한 알림 목록 영역 -->
        <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 -mr-2">
            <div id="notification-list" class="space-y-3">
                <!-- JavaScript로 알림 목록이 여기에 추가됩니다. -->
            </div>
        </div>
    </aside>

    <!-- =================================================================== -->
    <!-- 즐겨찾기 패널                                                      -->
    <!-- =================================================================== -->
    <aside
            id="favorite-panel"
            class="absolute top-0 w-[450px] bg-white p-6 flex flex-col h-full shadow-lg z-20 transform translate-x-full transition-transform duration-300 ease-in-out"
            style="right: 75px"
    >
        <!-- 즐겨찾기 패널 헤더 -->
        <div
                class="flex justify-between items-center mb-4 pb-4 border-b flex-shrink-0"
        >
            <h2 class="text-xl font-bold text-gray-800">즐겨찾기</h2>
            <button
                    id="close-favorite-panel"
                    class="p-2 rounded-full hover:bg-gray-200 transition-colors"
                    title="즐겨찾기 패널 닫기"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18L18 6M6 6l12 12"
                    />
                </svg>
            </button>
        </div>

        <!-- 즐겨찾기 필터링 -->
        <div class="mb-4 flex-shrink-0">
            <div
                    class="flex items-center justify-between bg-gray-50 p-3 rounded-lg"
            >
                <span class="text-sm text-gray-700">총 12개 매물</span>
                <select class="text-sm border border-gray-300 rounded px-2 py-1">
                    <option>최근 순</option>
                    <option>가격 낮은 순</option>
                    <option>가격 높은 순</option>
                </select>
            </div>
        </div>

        <!-- 스크롤 가능한 즐겨찾기 목록 영역 -->
        <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 -mr-2">
            <div id="favorite-list" class="grid grid-cols-1 gap-4">
                <!-- JavaScript로 즐겨찾기 목록이 여기에 추가됩니다. -->
            </div>
        </div>
    </aside>

    <!-- =================================================================== -->
    <!-- 비교 패널                                                          -->
    <!-- =================================================================== -->
    <aside
            id="compare-panel"
            class="absolute top-0 w-[450px] bg-white p-6 flex flex-col h-full shadow-lg z-20 transform translate-x-full transition-transform duration-300 ease-in-out"
            style="right: 75px"
    >
        <!-- 비교 패널 헤더 -->
        <div
                class="flex justify-between items-center mb-4 pb-4 border-b flex-shrink-0"
        >
            <h2 class="text-xl font-bold text-gray-800">매물 비교</h2>
            <button
                    id="close-compare-panel"
                    class="p-2 rounded-full hover:bg-gray-200 transition-colors"
                    title="비교 패널 닫기"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18L18 6M6 6l12 12"
                    />
                </svg>
            </button>
        </div>

        <!-- 비교 그룹 관리 -->
        <div class="mb-4 flex-shrink-0">
            <div
                    class="flex items-center justify-between bg-gray-50 p-3 rounded-lg"
            >
                <span class="text-sm text-gray-700">비교 그룹 2개</span>
                <button
                        class="text-sm text-blue-600 hover:text-blue-800 font-medium"
                >
                    새 그룹 추가
                </button>
            </div>
        </div>

        <!-- 스크롤 가능한 비교 목록 영역 -->
        <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 -mr-2">
            <div id="compare-list" class="flex flex-col gap-4">
                <!-- JavaScript로 비교 그룹이 여기에 추가됩니다. -->
            </div>
        </div>
    </aside>

    <!-- =================================================================== -->
    <!-- 내 매물 관리 패널                                                   -->
    <!-- =================================================================== -->
    <aside
            id="my-property-panel"
            class="absolute top-0 w-[450px] bg-white p-6 flex flex-col h-full shadow-lg z-20 transform translate-x-full transition-transform duration-300 ease-in-out"
            style="right: 75px"
    >
        <!-- 내 매물 관리 패널 헤더 -->
        <div
                class="flex justify-between items-center mb-4 pb-4 border-b flex-shrink-0"
        >
            <h2 class="text-xl font-bold text-gray-800">내 매물 관리</h2>
            <button
                    id="close-my-property-panel"
                    class="p-2 rounded-full hover:bg-gray-200 transition-colors"
                    title="내 매물 관리 패널 닫기"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18L18 6M6 6l12 12"
                    />
                </svg>
            </button>
        </div>

        <!-- 내 매물 요약 및 새 등록 -->
        <div class="mb-4 flex-shrink-0">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-3">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="font-semibold text-gray-800">총 매물</h3>
                        <p class="text-2xl font-bold text-blue-600">3개</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-600">이번 달 조회수</p>
                        <p class="text-lg font-semibold text-gray-800">1,247회</p>
                    </div>
                </div>
            </div>

            <button
                    id="add-property-btn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                >
                    <path
                            fill-rule="evenodd"
                            d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                            clip-rule="evenodd"
                    />
                </svg>
                내 매물 등록
            </button>
        </div>

        <!-- 스크롤 가능한 내 매물 목록 영역 -->
        <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 -mr-2">
            <div id="my-property-list" class="space-y-4">
                <!-- JavaScript로 내 매물 목록이 여기에 추가됩니다. -->
            </div>
        </div>
    </aside>

    <!-- =================================================================== -->
    <!-- 오른쪽 상세 정보 패널 (슬라이드 기능 추가)                            -->
    <!-- =================================================================== -->
    <aside
            id="right-side-panel"
            class="absolute top-0 right-0 w-[75px] bg-white pt-4 px-2 pb-2 flex flex-col justify-between h-full shadow-lg z-20 transform transition-transform duration-300 ease-in-out"
    >
        <div class="flex flex-col items-center space-y-2">
            <!-- 상단 아이콘 버튼들 -->
            <button
                    id="home-button"
                    class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-8 w-8 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m0 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h3a1 1 0 001-1V10m-9-10"
                    />
                </svg>
            </button>
            <button
                    id="favorite-panel-button"
                    class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-8 w-8 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"
                    />
                </svg>
            </button>
            <button
                    id="compare-panel-button"
                    class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-8 w-8 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <rect x="3" y="3" width="7" height="7" />
                    <rect x="14" y="3" width="7" height="7" />
                    <rect x="3" y="14" width="7" height="7" />
                    <rect x="14" y="14" width="7" height="7" />
                </svg>
            </button>
            <button
                    id="my-property-button"
                    class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-8 w-8 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                    />
                </svg>
            </button>
            <button
                    id="chat-button"
                    class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-8 w-8 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                    />
                </svg>
            </button>
            <button
                    id="notification-button"
                    class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-8 w-8 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M13.73 21a2 2 0 01-3.46 0M8 8a4 4 0 018 0c0 5.5 2 6 2 6H6s2-.5 2-6z"
                    />
                </svg>
            </button>
            <button
                    id="profile-button"
                    class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-8 w-8 text-gray-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                    />
                </svg>
            </button>
        </div>
        <button
                id="logout-button"
                class="w-full aspect-square bg-[#FF3737] hover:brightness-95 transition-all rounded-2xl p-2 flex items-center justify-center"
        >
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-8 w-8 text-gray-700"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2.5"
            >
                <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M5.636 5.636a9 9 0 1012.728 0M12 3v9"
                />
            </svg>
        </button>
    </aside>

    <!-- 오른쪽 패널 토글 버튼 -->
    <button
            id="right-panel-toggle-button"
            class="absolute top-1/2 -translate-y-1/2 w-8 h-16 bg-white/90 shadow-lg rounded-l-lg flex items-center justify-center z-30 transition-all duration-300 ease-in-out"
            style="right: 75px"
    >
        <svg
                id="right-open-icon"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="hidden"
        >
            <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        <svg
                id="right-close-icon"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
        >
            <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
    </button>
</div>
<script src="js/data.js"></script>
<script src="js/ui-components.js"></script>
<script src="js/panel-manager.js"></script>
<script src="js/filter.js"></script>
<script src="js/property-management.js"></script>
<script src="js/app-init.js"></script>
<script type="module" src="./js/main.js"></script>
<script>
    const favoriteList = document.getElementById("favorite-list");

    // --- 즐겨찾기 매물 카드 생성 함수 (빨간색 하트 포함) ---
    function createFavoritePropertyCard(property) {
        const tagsHTML = property.tags
            .map((tag) => {
                let colorClass = "bg-blue-100 text-blue-800";
                if (tag === "직거래") colorClass = "bg-green-100 text-green-800";
                if (tag === "확인") colorClass = "bg-gray-200 text-gray-800";
                return `<span class="text-xs font-semibold mr-2 px-2.5 py-0.5 rounded ${colorClass}">${tag}</span>`;
            })
            .join("");

        return `
                <div class="bg-white rounded-lg shadow-md overflow-hidden transition-transform hover:scale-[1.02]">
                    <div class="relative">
                        <img src="${property.image}" alt="매물 사진" class="w-full h-40 object-cover">
                        <button class="absolute top-2 right-2 bg-white/70 p-1.5 rounded-full hover:bg-white">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-gray-900">${property.price}</h3>
                        <p class="text-gray-600 text-sm">${property.location}</p>
                        <p class="text-gray-500 text-xs my-2">${property.details}</p>
                        <div class="mt-3">
                            ${tagsHTML}
                        </div>
                    </div>
                </div>
            `;
    }

    // --- 즐겨찾기 매물 카드 생성 함수 (빨간색 하트 포함) ---
    function createFavoritePropertyCard(property) {
        const tagsHTML = property.tags
            .map((tag) => {
                let colorClass = "bg-blue-100 text-blue-800";
                if (tag === "직거래") colorClass = "bg-green-100 text-green-800";
                if (tag === "확인") colorClass = "bg-gray-200 text-gray-800";
                return `<span class="text-xs font-semibold mr-2 px-2.5 py-0.5 rounded ${colorClass}">${tag}</span>`;
            })
            .join("");

        return `
                <div class="bg-white rounded-lg shadow-md overflow-hidden transition-transform hover:scale-[1.02]">
                    <div class="relative">
                        <img src="${property.image}" alt="매물 사진" class="w-full h-40 object-cover">
                        <button class="absolute top-2 right-2 bg-white/70 p-1.5 rounded-full hover:bg-white">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-gray-900">${property.price}</h3>
                        <p class="text-gray-600 text-sm">${property.location}</p>
                        <p class="text-gray-500 text-xs my-2">${property.details}</p>
                        <div class="mt-3">
                            ${tagsHTML}
                        </div>
                    </div>
                </div>
            `;
    }

    // 즐겨찾기 매물 렌더링 함수
    function renderFavoriteProperties() {
        favoriteList.innerHTML = "";
        favoriteProperties.forEach((property) => {
            const cardHTML = createFavoritePropertyCard(property);
            favoriteList.innerHTML += cardHTML;
        });
    }


        // 패널 별 렌더링
        if (panelName === "favorite") loadMyFavorites();
        // ✅ DTO -> 카드 HTML (PropertyFavoriteDto 기반)
    function cardFromFavoriteDto(it){
return `
<div class="favorite-card bg-white rounded-lg shadow-md overflow-hidden">
<div class="relative">
  ${it.thumbnailUrl
    ? `<img src="${escapeHtml(it.thumbnailUrl)}" class="w-full h-40 object-cover">`
    : `<div class="w-full h-40 bg-gray-100 flex items-center justify-center text-gray-400 text-xs">NO IMG</div>`}
  <button class="absolute top-2 right-2 bg-white/70 p-1.5 rounded-full hover:bg-white"
          title="즐겨찾기 해제" data-remove-fav="${it.propertyId}">
    ❤️
  </button>
</div>
<div class="p-4">
  <h3 class="font-bold text-lg">${escapeHtml(it.title ?? '')}</h3>
  <p class="text-sm text-gray-600">${escapeHtml(it.address ?? '')}</p>
  <div class="mt-2 text-xs text-gray-500">담김: ${timeKST(it.createdAt)}</div>
  <button class="mt-2 px-2 py-1 text-xs border rounded" data-open-id="${it.propertyId}">상세보기</button>
</div>
</div>`;
}

    // ✅ 서버에서 즐겨찾기 목록 받아서 그리드에 삽입
    async function loadMyFavorites(){
      const box = document.getElementById('favorite-list');
      if(!box) return;
      box.innerHTML = `<div class="p-4 text-sm text-gray-500">불러오는 중...</div>`;

      try{
        const r = await fetch(`${BASE}/api/me/favorites?limit=100`, { headers: authHeaders() });
        if(r.status === 401){ box.innerHTML = `<div class="p-4 text-sm text-red-500">로그인이 필요합니다.</div>`; return; }
        if(!r.ok) throw new Error('HTTP '+r.status);
        const list = await r.json();

        if(!list.length){
          box.innerHTML = `<div class="p-6 text-center text-gray-500 border border-dashed rounded-lg">아직 즐겨찾기한 매물이 없습니다.</div>`;
          return;
        }

        box.innerHTML = '';
        for(const it of list){
          box.insertAdjacentHTML('beforeend', cardFromFavoriteDto(it));
        }
      }catch(e){
        console.error(e);
        box.innerHTML = `<div class="p-4 text-sm text-red-500">목록을 불러오지 못했습니다.</div>`;
      }
    }

    // ✅ 하트 해제(토글) & 상세보기 (이벤트 위임)
    document.getElementById('favorite-list')?.addEventListener('click', async (e) => {
      const removeBtn = e.target.closest('[data-remove-fav]');
      const openBtn   = e.target.closest('[data-open-id]');

      if (removeBtn) {
        const pid = Number(removeBtn.dataset.removeFav);
        const r = await api(`/api/properties/${pid}/favorite`, { method: 'POST' });
        if (r.status === 401) { alert('로그인이 필요합니다.'); return; }
        if (!r.ok) { alert('즐겨찾기 해제 실패'); return; }
        removeBtn.closest('.favorite-card')?.remove();
        const box = document.getElementById('favorite-list');
        if (box && !box.children.length) {
          box.innerHTML = `<div class="p-6 text-center text-gray-500 border border-dashed rounded-lg">아직 즐겨찾기한 매물이 없습니다.</div>`;
        }
      }

      if (openBtn) {
        const pid = Number(openBtn.dataset.openId);
        if (window.loadPropertyDetail && window.app) {
          window.loadPropertyDetail(window.app, pid);
        } else {
          location.href = `/property/${pid}`;
        }
      }
    });

    </script>
    <script>
    const favListEl = document.getElementById('favorite-list');

    // 비어있을 때 표시용 요소를 만들어 재사용 (컨테이너가 <ul>이면 <li>로!)
    function ensureEmptyPlaceholder() {
      // 컨테이너가 UL/OL이라면 LI로, TABLE/TBODY면 TR/TD로 맞춰 주세요.
      const isList = favListEl?.tagName === 'UL' || favListEl?.tagName === 'OL';
      const placeholderSelector = '[data-empty-placeholder]';
      let ph = favListEl?.querySelector(placeholderSelector);
      if (!ph) {
        ph = document.createElement(isList ? 'li' : 'div');
        ph.setAttribute('data-empty-placeholder', 'true');
        ph.className = 'p-6 text-center text-gray-500 border border-dashed rounded-lg w-full';
        ph.textContent = '아직 즐겨찾기한 매물이 없습니다.';
        favListEl?.appendChild(ph);
      }
    }

    function removeEmptyPlaceholderIfAny() {
      favListEl?.querySelector('[data-empty-placeholder]')?.remove();
    }
    const inflight = new Set();
    favListEl?.addEventListener('click', async (e) => {
      const removeBtn = e.target.closest('[data-remove-fav]');
      const openBtn   = e.target.closest('[data-open-id]');


      // 하트(즐겨찾기 해제)
      if (removeBtn) {
        const pid  = Number(removeBtn.dataset.removeFav);
        const card = removeBtn.closest('.favorite-card');

        // ✅ 이미 같은 pid 요청이 진행 중이면 무시
        if (inflight.has(pid)) {
          return;
        }
        inflight.add(pid);

        // ✅ 오타 수정
        removeBtn.disabled = true;
        card?.classList.add('opacity-50');

        try {
          const r = await fetch(`${BASE}/api/properties/${pid}/favorite`, {
            method: 'POST',  // 서버가 토글이면 POST, 삭제 전용이면 DELETE
            headers: authHeaders()
          });

          if (r.status === 401) {
            alert('로그인이 필요합니다.');
            throw new Error('unauthorized');
          }
          if (!r.ok) {
            throw new Error(`toggle failed (status ${r.status})`);
          }

          // 성공 처리
          // 안전하게 카드 제거
          card?.remove();

          // 남은 카드가 있는지 확인 (placeholder는 제외)
          const remaining = [...favListEl.children].filter(el => !el.matches('[data-empty-placeholder]'));
          if (remaining.length === 0) {
            ensureEmptyPlaceholder(); // ✅ 컨테이너 타입에 맞는 태그로 추가
          }

        } catch (err) {
          console.error(err);
          alert('즐겨찾기 해제 실패');
          // 실패 시 UI 복구 (카드가 이미 remove 됐다면 안전하게 옵셔널 체이닝)
          removeBtn.disabled = false;    // ✅ Disabled → disabled
          card?.classList.remove('opacity-50');
        }finally {
            inflight.delete(pid);          // ✅ 요청 끝나면 해제
        }
        return;
      }

      // 상세 보기
      if (openBtn) {
        const pid = Number(openBtn.dataset.openId);
        if (window.loadPropertyDetail && window.app) {
          window.loadPropertyDetail(window.app, pid);
        } else {
          location.href = `/property/${pid}`;
        }
      }
    });

    // 초기 로딩 시, 목록이 비어있다면 placeholder를 붙여줌
    if (favListEl && favListEl.children.length === 0) {
      ensureEmptyPlaceholder();
    } else {
      removeEmptyPlaceholderIfAny();
    }
</script>
</body>
</html>